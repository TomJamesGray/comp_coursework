#:import Factory kivy.factory.Factory

<StatAnalysis>:
    primary_pane:primary_pane
    log_view:log_view
    width:root.width
    height:root.height
    ActionBar:
        width:root.width
        height:40
        size_hint_x:1
        pos:0,root.height-self.height
        ActionView:
            use_seperator:True
            ActionPrevious:
                with_previous:False
                size_hint_x:None
                width:0
                app_icon_width:1
                app_icon_height:0
            ActionButton:
                text:"Home"
                on_press:primary_pane.go_home()
            ActionButton:
                text:"Save"
                on_press:app.save_btn()
            ActionButton:
                text:"Load"
                on_press:app.load_btn()
            ActionButton:
                text:"Run action"
                on_press:primary_pane.active_action.run()


    BoxLayout:
        orientation:"horizontal"
        spacing:5,5
        width:root.width
        height:root.height-40
        padding:5,5,0,5
        Splitter:
            size_hint_x:None
            sizable_from:"right"
            max_size:300
            min_size:180
            rescale_with_parent:True
            strip_cls:Factory.get("MainSplitterStrip")
            ActionsScroller:
                primary_pane_edit:primary_pane
                canvas.before:
                    Color:
                        rgba:(1,1,1,1)
                    Rectangle:
                        pos:self.pos
                        size:self.size
                size_hint_y:1
        GridLayout:
            cols:1
            padding:5,0,5,0
            spacing:5,5
            PrimaryPane:
                id:primary_pane
                title:"Home"
                canvas.before:
                    Color:
                        rgba:(1,1,1,1)
                    Rectangle:
                        pos:self.pos
                        size:self.size
                HomeView:
                    size_hint_y:0.8
            Splitter:
                sizable_from:"top"
                size_hint_y:None
                min_size:100
                max_size:250
                strip_cls:Factory.get("MainSplitterStrip")
                LogView:
                    id:log_view
                    canvas.before:
                        Color:
                            rgba:(.9,.9,.9,1)
                        Rectangle:
                            pos:self.pos
                            size:self.size
                    size_hint_y:0.2



<LogText>:
    font_size:12
    text_size:self.width,None
    size_hint:1,None
    background_normal:""
    cursor_color:0,0,0,1
    height: max((len(self._lines)+1) * self.line_height, self.parent.height)
    # Hack Font - http://sourcefoundry.org/hack/
    font_name:"res/Hack-Regular.ttf"

<LogView>:
    cols:1
    output:output
    TitlePane:
        title:"Log"
        height:30
        size_hint_y:None
    ScrollView:
        bar_width:5
        bar_inactive_color:190/255,190/255,190/255,1
        bar_color:190/255,190/255,190/255,1
        LogText:
            id:output
            markup:True

<PrimaryPane>:
    cols:1
    TitlePane:
        title:root.title
        height:30
        size_hint_y:None

<HomeView>:
    datasets_grid:datasets_grid
    actions_grid:actions_grid
    cols:1
    height:self.minimum_height
    GridLayout:
        cols:1
        padding:15,15
        Label:
            color:0,0,0,1
            text:"Datasets"
            size_hint_y:None
            valign:"middle"
            text_size:self.size
            height:40
            font_size:18

        ActionsGrid:
            size_hint_y:None
            size_hint_x:None
            width:400
            cols:3
            row_default_height:30
            row_force_default:True
            id:datasets_grid
            on_parent:self.render(app.datasets)
            height:self.minimum_height
        Label:
            color:0,0,0,1
            text:"Saved Actions"
            size_hint_y:None
            valign:"middle"
            text_size:self.size
            height:40
            font_size:18

        ActionsGrid:
            size_hint_y:None
            size_hint_x:None
            width:400
            cols:3
            row_default_height:30
            row_force_default:True
            id:actions_grid
            on_parent:self.render(app.saved_actions)


<BorderedLabel>
#    text_size: self.size
    canvas.before:
        Color:
            rgba:root.b_color
        Rectangle:
            pos:self.x-self.b_width,self.y-self.b_width
            size:self.width+self.b_width*2,self.height+self.b_width*2
        Color:
            rgba:1,1,1,1
        Rectangle:
            pos:self.x,self.y
            size:self.width,self.height

<BorderedSpinner>
    canvas.before:
        Color:
            rgba:0,0,0,1
        Rectangle:
            pos:self.x-self.b_width,self.y-self.b_width
            size:self.width+self.b_width*2,self.height+self.b_width*2
        Color:
            rgba:1,1,1,1
        Rectangle:
            pos:self.x,self.y
            size:self.width,self.height

<BorderedButton>
    canvas.after:
        Color:
            rgba:root.b_color
        # Left vertical
        Rectangle:
            pos:self.x,self.y
            size:self.b_width,self.height
        # Right vertical
        Rectangle:
            pos:self.x+self.width-self.b_width,self.y
            size:self.b_width,self.height
        # Bottom horizontal
        Rectangle:
            pos:self.x,self.y
            size:self.width,self.b_width
        # Top horizontal
        Rectangle:
            pos:self.x,self.y+self.height-self.b_width
            size:self.width,self.b_width


<ButtonDropDown>
    background_normal:""
    background_down:""
    color:0,0,0,1
    background_color:1,1,1,1
    b_width:1
    size_hint:None,None
    height:25
    size_hint_x:1
    text_size:self.size
    padding:5,5
    canvas.after:
        Color:
            rgba:self.b_color
        Rectangle:
            pos:self.x,self.y-self.b_width
            size:self.b_width,self.height+self.b_width*2
        Rectangle:
            pos:self.x+self.width-1,self.y-self.b_width
            size:self.b_width,self.height+self.b_width*2
        Rectangle:
            pos:(self.x,self.y) if self.bottom else (0,0)
            size:(self.width,self.b_width) if self.bottom else (0,0)


<TitlePane>:
    Label:
        text:root.title
        text_size:self.size
        valign:"middle"
        pos:root.pos
        size:root.size
        color:(1,1,1,1)
        padding:5,0
        canvas.before:
            Color:
                rgba:app.title_pane_col
            Rectangle:
                pos:self.pos
                size:self.size

<ResultOutputWidget>:
    label_header:label_header
    size_hint_y:None
    cols:1
    padding:5,5
    canvas.before:
        Color:
            rgba:.6,.6,.6,1
        Rectangle:
            pos:self.x,self.y+10
            size:1,self.height-20
    Label:
        text:"Result"
        size_hint:1,None
        text_size:self.size
        color:app.accent_col
        height:30
        font_size:"22"
        halign:"left"
        id:label_header

<FileChooserSaveDialog>
    text_input:text_input
    size_hint:1,1
    orientation:"vertical"
    FileChooserListView:
        id:filechooser
        path:root.initial_path
    TextInput:
        id: text_input
        size_hint_y: None
        height: 30
        multiline: False
        text:root.default_file_name
        select_text:0,3

    BoxLayout:
        size_hint_y: None
        height: 30
        Button:
            text: "Cancel"
        Button:
            text: "Save"
            on_release: root.on_save(filechooser.path,text_input.text)

<FileChooserLoadDialog>
    size_hint:1,1
    orientation:"vertical"
    FileChooserListView:
        id:filechooser
        path:root.initial_path

    BoxLayout:
        size_hint_y: None
        height: 30
        Button:
            text: "Cancel"
        Button:
            text: "Load"
            on_release:root.on_load(filechooser.path,filechooser.selection)

<FormInputLabelText>
    size_hint_y:None
    text_size:self.width,None
    height:self.texture_size[1]
    color:0,0,0,1
    font_size:"14"
    pos_hint_y:0.5

<ToolTipText>
    size_hint_y:None
    width:150
    text_size:self.width,None
    height:self.texture_size[1]
    color:0,0,0,1
    font_size:"14"
    padding:5,5
    canvas.before:
        Color:
            rgba: 77/255,77/255,77/255,0.4
        RoundedRectangle:
            pos:self.x,self.y
            size:self.width,self.height
            radius:[1,]